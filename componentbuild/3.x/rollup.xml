<?xml version="1.0" encoding="UTF-8"?>

<project name="YuiRollupTargets">

    <import file="common.xml" description="Targets common to Rollup/Module" />

    <target name="build" depends="corebuild" description="Create component.js"></target>

	<target name="corebuild" depends="debugbuild">
		<copy file="${component.builddir}/${component.basefilename}-debug.js" tofile="${component.builddir}/${component.basefilename}.js" />

        <replaceregexp file="${component.builddir}/${component.basefilename}.js"
                            byline="${component.logger.regex.byline}"
                            match="${component.logger.regex}"
                            replace="${component.logger.regex.replace}"
                            flags="${component.logger.regex.flags}" />
	</target>

    <target name="debugbuild" depends="-concatdebug, -registerdebug, -prependdebug, -appenddebug" description="Create component-debug.js">
        <fixcrlf srcdir="${component.builddir}" eol="${buildfiles.eol}" />
    </target>

    <target name="-concatdebug">
        <subant target="${component.rollup.target}" inheritall="false" >
            <filelist dir="${buildfile.dir}" files="${component.rollup.modules.buildfiles}" />
            <property name="rollup" value="true" />
            <property name="rollup.builddir" value="${component.builddir}" />
            <property name="rollup.component" value="${component}" />
            <property name="rollup.component.basefilename" value="${component.basefilename}" />
        </subant>
    </target>

    <target name="-registerdebug" unless="skip.register">
        <addrollup module="${component.module}" file="${component.builddir}/${component.basefilename}-debug.js" details="${component.details.hash}" />
    </target>

	<!--
    <target name="register" unless="skip.register">
        <addrollup module="${component.module}" file="${component.builddir}/${component.basefilename}.js" details="${component.details.hash}" />
        <addrollup module="${component.module}" file="${component.builddir}/${component.basefilename}-debug.js" details="${component.details.hash}" />
    </target>
	-->
</project>